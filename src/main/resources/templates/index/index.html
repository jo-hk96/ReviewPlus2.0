<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
                  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
                  
 
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/top_rate.css">
    <link rel="stylesheet" href="/css/now_playing.css">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/scroll-to-top.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%2210 0 100 100%22><text y=%22.90em%22 font-size=%2290%22>ğŸ¬</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link rel="stylesheet" href= "/css/latest_news.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>ë¦¬ë·°í”ŒëŸ¬ìŠ¤</title>
</head>
<style>
#userProfilePicture{
	width: 50px;
	height: 50px;
	border-radius: 25px;
	border:1px solid white;
	object-fit:cover;
}
</style>

<body>
	<body>
	<!--ìµëª…ì‚¬ìš©ì(ë¹„ë¡œê·¸ì¸ìƒíƒœ)isAnonymous -->
	<!--ì‚¬ìš©ì(ë¡œê·¸ì¸ìƒíƒœ)isAuthenticated -->
    <div id="header" th:fragment="header">                  
	        <a href="/" class="logo">
	           <img th:src="@{/images/logo.png}" alt ="ë¡œê³ " >
	        </a>
       	<div sec:authorize="isAuthenticated()" class = "headerLeft">
       	
				<a href = "/UserMypage"><img
				    id = "userProfilePicture" th:src="@{'/images/profile/' + ${profileFileName}}" 
				    alt="í”„ë¡œí•„ ì‚¬ì§„" ></a>
				    
       			<!-- ROLE_DORMANT -->
			    <span sec:authorize="hasRole('ROLE_DORMANT')">
			        íœ´ë©´ê³„ì •
			          <b><a href = "/UserDormant" > ê´€ë¦¬ìë¬¸ì˜ </a></b>
			    </span>
			    
	       		<!-- ROLE_ADMIN -->
			    <span sec:authorize="hasRole('ROLE_ADMIN')">
			        ê´€ë¦¬ì : <span th:text = "${#authentication.principal.nickname}"></span>
			        <b><a href="/Admin/AdminHome">ì‚¬ì´íŠ¸ê´€ë¦¬</a></b>
			    </span>
			    
			    <!-- ROLE_USER -->
			    <span sec:authorize="hasRole('ROLE_USER')">
			       <b><span th:text = "${#authentication.principal.nickname}" ></span></b>
			    </span>
			    <span><a href="/MoviesList">ì¸ê¸°</a></span>
			    <span><a href="/MoviesList?category=upcoming">ê°œë´‰ì˜ˆì •</a></span>
	    </div>
	    
	    
	    <!-- í—¤ë”ìƒë‹¨ ë©”ë‰´ -->
	    <div sec:authorize="isAnonymous()" class = "headerLeft">
			    <span><a href="/MoviesList">ì¸ê¸°</a></span>
			    <span><a href="/MoviesList?category=upcoming">ê°œë´‰ì˜ˆì •</a></span>
	    </div>
	    
	    
	    
		<!-- í—¤ë” ì˜¤ë¥¸ìª½ ìƒë‹¨ ë©”ë‰´ -->	
	    <div class="headerRight">
				<div class ="userIndex" sec:authorize="isAnonymous()">
					<a href = "/UserLoginMain">ë¡œê·¸ì¸</a>
				</div>
				
				<div class ="userIndex"  sec:authorize="isAuthenticated()">
					<a href = "/logout"  onclick = "return confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ë¡œê·¸ì•„ì›ƒ</a>
				</div>
				
			    <div>
				    <form action="/MoviesList" method="get" class="search-form-container"> 
					        <input type="text" id="movieSearch" name="movieSearch" 
					               placeholder="ì˜í™” ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. ex)ë°˜ì§€,ë°˜ì§€ì˜,ë°˜ì§€ì˜ ì œì™•,The Lord ,Lord of">
					        
					        <button type="submit" class="search-icon-btn">
					            <i class="fa-solid fa-magnifying-glass" style ="color:gray;"></i>
					        </button>
				    </form>
				</div>
         </div>
	</div>
	
	<div id = "indexMovieList">
	  	 <!-- ê°œë´‰ì¤‘ì¸ ì˜í™”  -->
		 <div class="slider-container2">
	  		 	<h2><a id = "MainMovieListName" href ="/MoviesList?category=now_playing">í˜„ì¬ìƒì˜ì¤‘</a></h2>
			    <button id="prev-btn2" class="nav-btn2">&lt;</button> 
			  	  <div id="movie-list2"></div>
			    <button id="next-btn2" class="nav-btn2">&gt;</button> 
		 </div>
	 	 <div id="loading-indicator2">ì˜í™” ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ëŠ”ì¤‘...</div>
	 	 
	 	 <!-- ì˜í™” ë§¤ê±°ì§„ ìŠ¬ë¼ì´ë” -->
	 	<h2 class="news-title">ìµœì‹  ê¸°ì‚¬</h2>
        <div class="carousel-container">

            <div class="carousel-wrapper">
                <button class="arrow-btn prev-btn"><i class="fas fa-chevron-left"></i></button>

                <div class="news-list-container">
                    <div class="news-list" id="naver-news-list">
                        <p>ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>

                <button class="arrow-btn next-btn"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>

	 	 
		  <!--ìµœê³ í‰ì -->
		  <div class="slider-container">
		  		<h2><a id= "MainMovieListName" href ="/MoviesList?category=top_rated">ìµœê³ í‰ì </a></h2>
			    <button id="prev-btn" class="nav-btn">&lt;</button> 
			    	<div id="movie-list"></div>
			    <button id="next-btn" class="nav-btn">&gt;</button> 
		  </div>
		  <div id="loading-indicator">ì˜í™” ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ëŠ”ì¤‘...</div>
	</div>
	
	<!--  Url ì•µì»¤ : #review-' + ${review.reviewId} -->
	<div class = "slider-container2">	
			<h2 style="color:#e83939;">ìµœì‹  ë¦¬ë·°</h2>
			<div class="review-container">
					  	<a class="review-card" th:each ="review : ${recentReviews}"
				           th:href="@{/detail/{apiId}(apiId=${review.apiId})} + '#review-' + ${review.reviewId}"
				           style="text-decoration: none; color: black;">
								    <span>[[${review.nickname}]]</span><br>
								  	<b>[[${review.title}]]</b><br>
								    <b id = "comment">"[[${review.comment}]]"</b><br>
								    <span class="rating">
							            <span th:text="${#strings.repeat('â­', #numbers.formatInteger(review.rating, 0))}"></span>
						        	</span>
								    <span id = "regdate">[[${review.regDate}]]</span>
						</a>
			</div>
	</div>
		<p th:if ="${recentReviews.isEmpty()}">ì•„ì§ ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
		
	<!-- -----------------------í‘¸í„°--------------------------- -->
    <div id = "footer" th:fragment = "footer" style="color:white;">
    	<a href="/" class="logo">
           <img th:src="@{/images/logo.png}" style ="width:100px;" alt ="ë¡œê³ " >
        </a> 
        <p style = "color:grey;">ë¦¬ë·°í”ŒëŸ¬ìŠ¤ì—ì„œ ì‚¬ìš©ëœ ëª¨ë“  ì˜í™” ì •ë³´ëŠ” 
           <span style ="font-size:15px; font-weight:bold" >
                  <a href ="https://www.themoviedb.org/" style = "text-decoration: none; font-size :17px;">
                        TMDb(The Movie Database)
                  </a>
         	</span>í†µí•´ ì œê³µë˜ì—ˆìŠµë‹ˆë‹¤.
        </p>
        <p>ì£¼ì†Œ:ëª»ê³¨ë²ˆì˜ë¡œ 56ë²ˆê¸¸ 8<br>Â© 2025 ReviewPlus.All Rights Reserved.</p>
    </div>
    <!-- --------------------------------------------------------------------- -->


<script>
            document.addEventListener('DOMContentLoaded', function() {
                const newsListContainer = document.getElementById('naver-news-list');
                // display=10ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ 10ê°œì˜ ë‰´ìŠ¤ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
                // ì°¸ê³ : ì´ ê²½ë¡œëŠ” ì„œë²„ì—ì„œ ë„¤ì´ë²„ APIë¥¼ í˜¸ì¶œí•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ì—¬ì•¼ í•©ë‹ˆë‹¤.
                const apiUrl = '/api/naver/news?query=ì˜í™”&display=10';

                // -----------------------------------------------------
                // 1. AJAX ë°ì´í„° ë¡œë”© ë¡œì§
                // -----------------------------------------------------
                fetch(apiUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨: ' + response.status);
                        }
                        // ê°€ì •: ì„œë²„ì—ì„œ ë„¤ì´ë²„ APIì˜ JSON ì‘ë‹µ ì¤‘ 'items' ë°°ì—´ì„ ê·¸ëŒ€ë¡œ ë°˜í™˜í•œë‹¤ê³  ê°€ì •
                        return response.json();
                    })
                    .then(data => {
                        // 'data'ê°€ ë„¤ì´ë²„ API ì‘ë‹µì˜ 'items' ë°°ì—´ì´ë¼ê³  ê°€ì •
                        const newsItems = Array.isArray(data) ? data : (data.items || []);

                        // "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..." ë©”ì‹œì§€ ì œê±° ë° HTML ìƒì„±
                        newsListContainer.innerHTML = '';

                        if (newsItems.length > 0) {
                            newsItems.forEach(item => {
                                // ë„¤ì´ë²„ APIì— ì´ë¯¸ì§€ê°€ ì œê³µë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, í”Œë ˆì´ìŠ¤í™€ë” ì‚¬ìš©
                                const imageUrl = "https://via.placeholder.com/300x180?text=Movie+News";

                                // ë„¤ì´ë²„ APIì˜ titleì—ì„œ <b> íƒœê·¸ë¥¼ ì œê±°í•˜ì—¬ ìˆœìˆ˜ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
                                const cleanTitle = removeHtmlTags(item.title);
                                const formattedDate = formatDate(item.pubDate);

                                // ê¸°ì¡´ HTML êµ¬ì¡°ì— ë§ì¶˜ ë™ì  ì•„ì´í…œ ìƒì„±
                                const itemHtml = `
                            <a href="${item.link}" target="_blank">
                                <img src="${imageUrl}" alt="${cleanTitle} ë‰´ìŠ¤ ì´ë¯¸ì§€">
                            </a>
                            <p class="title">${cleanTitle}</p>
                            <p class="date">${formattedDate}</p>
                        `;

                                const newsItemDiv = document.createElement('div');
                                newsItemDiv.className = 'news-item';
                                newsItemDiv.innerHTML = itemHtml;
                                newsListContainer.appendChild(newsItemDiv);
                            });

                            // ğŸ’¡ ë°ì´í„° ë¡œë“œê°€ ì™„ë£Œëœ í›„, ìºëŸ¬ì…€ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
                            initializeCarousel();
                        } else {
                            newsListContainer.innerHTML = '<p>ê²€ìƒ‰ëœ ë‰´ìŠ¤ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                        }
                    })
                    .catch(error => {
                        console.error('ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                        newsListContainer.innerHTML = '<p style="color: red;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                    });

                // -----------------------------------------------------
                // 2. ìºëŸ¬ì…€ ì œì–´ ë¡œì§ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
                // -----------------------------------------------------
                function initializeCarousel() {
                    const newsList = document.getElementById('naver-news-list');
                    const prevBtn = document.querySelector('.prev-btn');
                    const nextBtn = document.querySelector('.next-btn');
                    const items = newsList.querySelectorAll('.news-item');

                    if (items.length === 0) return;

                    let currentIndex = 0;
                    const totalItems = items.length;

                    // ìºëŸ¬ì…€ ë„ˆë¹„ ì„¤ì • (ì•„ì´í…œ ê°œìˆ˜ë§Œí¼)
                    newsList.style.width = `${totalItems * 100}%`;

                    function updateCarousel() {
                        // ì•„ì´í…œ í•˜ë‚˜ë¥¼ 100%ë¡œ ê°€ì •í•˜ê³  ì´ë™
                        const offset = currentIndex * -100;
                        newsList.style.transform = `translateX(${offset / totalItems}%)`; // ì „ì²´ ë„ˆë¹„ ëŒ€ë¹„ ë¹„ìœ¨ë¡œ ì¡°ì •í•´ì•¼ í•¨. (ê°œì„  í•„ìš”: CSSì—ì„œ news-list-containerì˜ overflowë¥¼ hiddenìœ¼ë¡œ ì„¤ì •í•˜ê³ , news-listì˜ widthë¥¼ totalItems * [ì•„ì´í…œ ë„ˆë¹„]ë¡œ ì„¤ì •í•´ì•¼ ì •í™•í•©ë‹ˆë‹¤.)

                        // ì„ì‹œë¡œ news-listì˜ transformì„ ì•„ì´í…œ ë‹¨ìœ„ë¡œ ì²˜ë¦¬ (ì •í™•í•œ ìºëŸ¬ì…€ ë¡œì§ì€ CSSì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.)
                        const itemWidth = newsList.querySelector('.news-item').offsetWidth;
                        newsList.style.transform = `translateX(-${currentIndex * itemWidth}px)`;


                        prevBtn.disabled = currentIndex === 0;
                        nextBtn.disabled = currentIndex === totalItems - 1;
                    }

                    prevBtn.addEventListener('click', () => {
                        if (currentIndex > 0) {
                            currentIndex--;
                            updateCarousel();
                        }
                    });

                    nextBtn.addEventListener('click', () => {
                        if (currentIndex < totalItems - 1) {
                            currentIndex++;
                            updateCarousel();
                        }
                    });

                    updateCarousel();
                }

                // -----------------------------------------------------
                // 3. ë‚ ì§œ í˜•ì‹ ë³€í™˜ í•¨ìˆ˜ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
                // -----------------------------------------------------
                function formatDate(pubDate) {
                    try {
                        const dateObj = new Date(pubDate);
                        const year = dateObj.getFullYear();
                        const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                        const day = String(dateObj.getDate()).padStart(2, '0');
                        return `${year}-${month}-${day}`;
                    } catch (e) {
                        // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë˜ ê°’ ë°˜í™˜
                        return pubDate;
                    }
                }

                // -----------------------------------------------------
                // 4. HTML íƒœê·¸ ì œê±° í•¨ìˆ˜ (ë„¤ì´ë²„ API titleìš©)
                // -----------------------------------------------------
                function removeHtmlTags(htmlString) {
                    if (!htmlString) return '';
                    // ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ <...> í˜•íƒœì˜ ëª¨ë“  HTML íƒœê·¸ë¥¼ ì œê±°
                    return htmlString.replace(/<[^>]*>?/gm, '');
                }
            });
        </script>




<button id="scrollToTopBtn" style="display: none;" th:fragment ="scroll-to-top">
    <i class="fas fa-arrow-up fa-lg"></i>
</button>


<!--í”„ë¡œí•„ ì‚¬ì§„  -->
<script src="js/upload.js"></script>
	
 <!-- ì˜í™”ê²€ìƒ‰.js -->	
 <script src="js/movie_search.js"></script>
	
 <!--ì˜í™” ìŠ¬ë¼ì´ë” -->
 <script src="js/now_playing.js" type="module"></script>
 <script src="js/top_rate.js" type="module"></script>
 
 <!-- ë§¨ìœ„ë¡œê°€ê¸° -->
 <script src = "/js/scroll-to-top.js"></script>
 
 <!-- ë‰´ìŠ¤ ìŠ¬ë¼ì´ë“œ íš¨ê³¼ -->
 <script src="/js/latest_news.js" defer></script>
</body>
</html>